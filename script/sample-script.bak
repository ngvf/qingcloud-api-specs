#!/bin/bash
cd ..
ROOT_PATH=$PWD
$ROOT_PATH/tools/pretty-plugin/json-pretty -d $ROOT_PATH/spec -r true
RETURN=$?

if [ ! $RETURN -eq 0 ]; then
     exit 1
fi

docker run --volume $ROOT_PATH:/data jamescooke/openapi-validator \
	-r ./tools/swagger-validation/openapi-validation/spectral.yml \
	-c ./tools/swagger-validation/openapi-validation/validaterc \
	./spec/api-profile.json

RETURN=$?
if [ ! $RETURN -eq 0 ]; then
     exit 1
fi

docker run --rm -t \
  -v $ROOT_PATH:/specs:ro \
  sayi/openapi-diff \
  -new /specs/spec/api-profile.json -old /specs/scripts/temp/spec/api-profile.json
echo $?
